    private CollaboratingWorkbooksEnvironment(Map<String, WorkbookEvaluator> evaluatorsByName, WorkbookEvaluator[] evaluators) {
        IdentityHashMap<WorkbookEvaluator, String> uniqueEvals = new IdentityHashMap<WorkbookEvaluator, String>(evaluators.length);
        for (String wbName : evaluatorsByName.keySet()) {
            WorkbookEvaluator wbEval = evaluatorsByName.get(wbName);
            if (uniqueEvals.containsKey(wbEval)) {
                String msg = "Attempted to register same workbook under names '"
                    + uniqueEvals.get(wbEval) + "' and '" + wbName + "'";
                throw new IllegalArgumentException(msg);
            }
            uniqueEvals.put(wbEval, wbName);
        }
        unhookOldEnvironments(evaluators);
        hookNewEnvironment(evaluators, this);
        _unhooked = false;
        _evaluators = evaluators;
        _evaluatorsByName = evaluatorsByName;
    }

