    private Format getFormat(double cellValue, int formatIndex, String formatStr) {
       // Excel supports positive/negative/zero, but java
       // doesn't, so we need to do it specially
       if(formatStr.indexOf(';') != formatStr.lastIndexOf(';')) {
          int lastAt = formatStr.lastIndexOf(';');
          String zeroFormat = formatStr.substring(lastAt+1);
          String normalFormat = formatStr.substring(0,lastAt);
          if(cellValue == 0.0) {
             formatStr = zeroFormat;
          } else {
             formatStr = normalFormat;
          }
       }
      
       // See if we already have it cached
        Format format = formats.get(formatStr);
        if (format != null) {
            return format;
        }
        if ("General".equals(formatStr) || "@".equals(formatStr)) {
            if (DataFormatter.isWholeNumber(cellValue)) {
                return generalWholeNumFormat;
            }
            return generalDecimalNumFormat;
        }
        format = createFormat(cellValue, formatIndex, formatStr);
        formats.put(formatStr, format);
        return format;
    }

