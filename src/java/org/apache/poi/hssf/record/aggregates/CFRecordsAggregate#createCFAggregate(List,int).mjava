	/**
	 * Create CFRecordsAggregate from a list of CF Records
	 * @param recs - list of {@link Record} objects
	 * @param offset - position of {@link CFHeaderRecord} object in the list of Record objects
	 * @return CFRecordsAggregate object
	 */
	public static CFRecordsAggregate createCFAggregate(List recs, int pOffset)
	{
		Record rec = ( Record ) recs.get(pOffset);
		if (rec.getSid() != CFHeaderRecord.sid) {
			throw new IllegalStateException("next record sid was " + rec.getSid() 
					+ " instead of " + CFHeaderRecord.sid + " as expected");
		}

		CFHeaderRecord header = (CFHeaderRecord)rec;
		int nRules = header.getNumberOfConditionalFormats();

		CFRuleRecord[] rules = new CFRuleRecord[nRules];
		int offset = pOffset;
		int countFound = 0;
		while (countFound < rules.length) {
			offset++;
			if(offset>=recs.size()) {
				break;
			}
			rec = (Record)recs.get(offset);
			if(rec instanceof CFRuleRecord) {
				rules[countFound] = (CFRuleRecord) rec;
				countFound++;
			} else {
				break;
			}
		}

		if (countFound < nRules)
		{ // TODO -(MAR-2008) can this ever happen? write junit 
			
			if (log.check(POILogger.DEBUG))
			{
				log.log(POILogger.DEBUG, "Expected  " + nRules + " Conditional Formats, "
						+ "but found " + countFound + " rules");
			}
			header.setNumberOfConditionalFormats(nRules);
			CFRuleRecord[] lessRules = new CFRuleRecord[countFound];
			System.arraycopy(rules, 0, lessRules, 0, countFound);
			rules = lessRules;
		}
		return new CFRecordsAggregate(header, rules);
	}

