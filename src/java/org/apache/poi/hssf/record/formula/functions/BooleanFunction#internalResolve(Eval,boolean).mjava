    private ValueEval internalResolve(Eval ve, boolean stringsAreBlanks) {
        ValueEval retval = null;
        
        // blankeval is returned as is
        if (ve instanceof BlankEval) {
            retval = BlankEval.INSTANCE;
        }
        
        // stringeval
        else if (ve instanceof StringEval) {
            retval = stringsAreBlanks ? (ValueEval) BlankEval.INSTANCE : (StringEval) ve;
        }
        
        // bools are bools :)
        else if (ve instanceof BoolEval) {
            retval = (BoolEval) ve;
        }
        
        // convert numbers to bool
        else if (ve instanceof NumericValueEval) {
            NumericValueEval ne = (NumericValueEval) ve;
            double d = ne.getNumberValue();
            retval = Double.isNaN(d) 
                    ? (ValueEval) ErrorEval.VALUE_INVALID
                    : (d != 0) 
                        ? BoolEval.TRUE
                        : BoolEval.FALSE;
        }
        
        // since refevals
        else {
            retval = ErrorEval.VALUE_INVALID;
        }
        
        return retval;
        
    }

