	protected ValueEval evaluateFunc(ValueEval[] args, int srcCellRow, short srcCellCol)
			throws EvaluationException {
		if (args.length < 3 || args.length > 4) {
			return ErrorEval.VALUE_INVALID;
		}

		String oldStr = evaluateStringArg(args[0], srcCellRow, srcCellCol);
		String searchStr = evaluateStringArg(args[1], srcCellRow, srcCellCol);
		String newStr = evaluateStringArg(args[2], srcCellRow, srcCellCol);

		String result;
		switch (args.length) {
			default:
				throw new IllegalStateException("Cannot happen");
			case 4:
				int instanceNumber = evaluateIntArg(args[3], srcCellRow, srcCellCol);
				if (instanceNumber < 1) {
					return ErrorEval.VALUE_INVALID;
				}
				result = replaceOneOccurrence(oldStr, searchStr, newStr, instanceNumber);
				break;
			case 3:
				result = replaceAllOccurrences(oldStr, searchStr, newStr);
		}
		return new StringEval(result);
	}

