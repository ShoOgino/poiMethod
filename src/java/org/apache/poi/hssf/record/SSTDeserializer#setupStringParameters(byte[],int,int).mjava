    /**
     * Detemines the option types for the string (ie, compressed or uncompressed unicode, rich text string or
     * plain string etc) and calculates the length and offset for the string.
     *
     * @param data
     * @param index
     * @param char_count
     */
    private void setupStringParameters( final byte[] data, final int index,
                                        final int char_count )
    {
        byte optionFlag = data[index + LittleEndianConsts.SHORT_SIZE];

        wideChar = ( optionFlag & 1 ) == 1;
        boolean farEast = ( optionFlag & 4 ) == 4;
        boolean richText = ( optionFlag & 8 ) == 8;

        totalLengthBytes = SSTRecord.STRING_MINIMAL_OVERHEAD + calculateByteCount( char_count );
        stringDataOffset = SSTRecord.STRING_MINIMAL_OVERHEAD;
        if ( richText )
        {
            short run_count = LittleEndian.getShort( data, index + stringDataOffset );

            stringDataOffset += LittleEndianConsts.SHORT_SIZE;
            totalLengthBytes += LittleEndianConsts.SHORT_SIZE + ( LittleEndianConsts.INT_SIZE * run_count );
        }
        if ( farEast )
        {
            int extension_length = LittleEndian.getInt( data, index + stringDataOffset );

            stringDataOffset += LittleEndianConsts.INT_SIZE;
            totalLengthBytes += LittleEndianConsts.INT_SIZE + extension_length;
        }
    }

