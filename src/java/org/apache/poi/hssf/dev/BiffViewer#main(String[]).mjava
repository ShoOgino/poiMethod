	/**
	 * Method main with 1 argument just run straight biffview against given
	 * file<P>
	 *
	 * <b>Usage</b>:<br/>
	 *
	 * BiffViewer [--biffhex] [--noint] [--noescher] [--out] &lt;fileName&gt; <br/>
	 * BiffViewer --rawhex  [--out] &lt;fileName&gt; <br/>
	 * <br/>
	 *
	 * <table>
	 * <tr><td>--biffhex</td><td>show hex dump of each BIFF record</td></tr>
	 * <tr><td>--noint</td><td>do not output interpretation of BIFF records</td></tr>
	 * <tr><td>--out</td><td>send output to &lt;fileName&gt;.out</td></tr>
	 * <tr><td>--rawhex</td><td>output raw hex dump of whole workbook stream</td></tr>
	 * <tr><td>--escher</td><td>turn on deserialization of escher records (default is off)</td></tr>
	 * <tr><td>--noheader</td><td>do not print record header (default is on)</td></tr>
	 * </table>
	 *
	 */
	public static void main(String[] args) throws IOException, CommandParseException {
		// args = new String[] { "--out", "", };
		CommandArgs cmdArgs = CommandArgs.parse(args);

		PrintWriter pw;
		if (cmdArgs.shouldOutputToFile()) {
			OutputStream os = new FileOutputStream(cmdArgs.getFile().getAbsolutePath() + ".out");
			pw = new PrintWriter(new OutputStreamWriter(os, StringUtil.UTF8));
		} else {
		    // Use the system default encoding when sending to System Out
			pw = new PrintWriter(new OutputStreamWriter(System.out, Charset.defaultCharset()));
		}

        try {
            NPOIFSFileSystem fs = new NPOIFSFileSystem(cmdArgs.getFile(), true);
            try {
                InputStream is = getPOIFSInputStream(fs);

                try {
                    if (cmdArgs.shouldOutputRawHexOnly()) {
                        int size = is.available();
                        byte[] data = new byte[size];

                        is.read(data);
                        HexDump.dump(data, 0, System.out, 0);
                    } else {
                        boolean dumpInterpretedRecords = cmdArgs.shouldDumpRecordInterpretations();
                        boolean dumpHex = cmdArgs.shouldDumpBiffHex();
                        boolean zeroAlignHexDump = dumpInterpretedRecords;  // TODO - fix non-zeroAlign
                        runBiffViewer(pw, is, dumpInterpretedRecords, dumpHex, zeroAlignHexDump,
                                cmdArgs.suppressHeader());
                    }
                } finally {
                    is.close();
                }
            } finally {
                fs.close();
            }
        } finally {
            pw.close();
        }
	}

