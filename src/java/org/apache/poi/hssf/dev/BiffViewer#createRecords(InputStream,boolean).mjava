    /**
     *  Create an array of records from an input stream
     *
     *@param  in                         the InputStream from which the records
     *      will be obtained
     *@param  dump
     *@return                            an array of Records created from the
     *      InputStream
     *@exception  RecordFormatException  on error processing the InputStream
     */

    public static Record[] createRecords(InputStream in, boolean dump)
             throws RecordFormatException {
        ArrayList records = new ArrayList();
        Record last_record = null;
        int loc = 0;

        try {
//            long  offset  = 0;
            short rectype = 0;

            do {
                rectype = LittleEndian.readShort(in);
                System.out.println("============================================");
                System.out.println("Offset 0x" + Integer.toHexString(loc) + " (" + loc + ")");
                loc += 2;
                if (rectype != 0) {
                    short recsize = LittleEndian.readShort(in);

                    loc += 2;
                    byte[] data = new byte[(int) recsize];

                    in.read(data);
                    if ((rectype == WSBoolRecord.sid) && (recsize == 0)) {
                        System.out.println(loc);
                    }
                    loc += recsize;
//                    offset += 4 + recsize;
                    if (dump) {
                        dump(rectype, recsize, data);
                    }
                    Record[] recs = createRecord(rectype, recsize,
                            data);
                    // handle MulRK records

                    Record record = recs[0];

                    if ((record instanceof UnknownRecord)
                            && !dump) {
                        // if we didn't already dump
                        // just cause dump was on and we're hit an unknow
                        dumpUnknownRecord(data);
                    }
                    if (record != null) {
                        if (rectype == ContinueRecord.sid) {
                            dumpContinueRecord(last_record, dump, data);
                        } else {
                            last_record = record;
                            records.add(record);
                        }
                    }
                }
            } while (rectype != 0);
        } catch (IOException e) {
            throw new RecordFormatException("Error reading bytes");
        }
        Record[] retval = new Record[records.size()];

        retval = (Record[]) records.toArray(retval);
        return retval;
    }

