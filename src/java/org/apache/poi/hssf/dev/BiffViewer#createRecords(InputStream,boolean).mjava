    /**
     * Create an array of records from an input stream
     *
     * @param in the InputStream from which the records will be
     *           obtained
     * @param dump
     *
     * @return an array of Records created from the InputStream
     *
     * @exception RecordFormatException on error processing the
     *            InputStream
     */

    public static Record [] createRecords(InputStream in, boolean dump)
        throws RecordFormatException
    {
        ArrayList records     = new ArrayList();
        Record    last_record = null;
        int       loc         = 0;

        try
        {
//            long  offset  = 0;
            short rectype = 0;

            do
            {
                rectype = LittleEndian.readShort(in);
                System.out.println("============================================");
                System.out.println("you are at offset " + loc);
                loc     += 2;
                if (rectype != 0)
                {
                    short recsize = LittleEndian.readShort(in);

                    loc += 2;
                    byte[] data = new byte[ ( int ) recsize ];

                    in.read(data);
                    if ((rectype == WSBoolRecord.sid) && (recsize == 0))
                    {
                        System.out.println(loc);
                    }
                    loc    += recsize;
//                    offset += 4 + recsize;
                    if (dump)
                    {
//                        System.out
//                            .println("fixing to recordize the following");
                        System.out.println("rectype = 0x"
                                           + Integer.toHexString(rectype));
                        System.out.println("recsize = 0x"
                                           + Integer.toHexString(recsize));
                        System.out.println(
                            "--------------------------------------------");
                        if (data.length > 0)
                        {
                            HexDump.dump(data, 0, System.out, 0);
                        }
                        else
                        {
                            System.out.print("**NO RECORD DATA**");
                        }
                        System.out.println();
                        System.out.println(
                            "-END----------------------------------------");
                    }
                    Record[] recs = createRecord(rectype, recsize,
                                                 data);   // handle MulRK records

                    if (recs.length > 1)
                    {
                        for (int k = 0; k < recs.length; k++)
                        {
                            records.add(
                                recs[ k ]);               // these will be number records
                            last_record =
                                recs[ k ];                // do to keep the algorythm homogenous...you can't
                        }                                 // actually continue a number record anyhow.
                    }
                    else
                    {
                        Record record = recs[ 0 ];

                        if ((record instanceof UnknownRecord)
                                && !dump)                 // if we didn't already dump
                        {                                 // just cause dump was on and we're hit an unknow

                            // record hex dump it!
                            System.out.println(
                                "-----UNKNOWN----------------------------------");
                            if (data.length > 0)
                            {
                                HexDump.dump(data, 0, System.out, 0);
                            }
                            else
                            {
                                System.out.print("**NO RECORD DATA**");
                            }
                            System.out.println();
                            System.out.println(
                                "-----UNKNOWN----------------------------------");
                        }
                        if (record != null)
                        {
                            if (rectype == ContinueRecord.sid)
                            {
                                if (last_record == null)
                                {
                                    throw new RecordFormatException(
                                        "First record is a ContinueRecord??");
                                }
                                if (dump)
                                {
                                    System.out.println(
                                        "-----PRECONTINUED LAST RECORD WOULD SERIALIZE LIKE:");
                                    byte[] lr = last_record.serialize();

                                    if (lr != null)
                                    {
                                        HexDump.dump(last_record.serialize(),
                                                     0, System.out, 0);
                                    }
                                    System.out.println();
                                    System.out.println(
                                        "-----PRECONTINUED----------------------------------");
                                }
                                last_record.processContinueRecord(data);
                                if (dump)
                                {
                                    System.out.println(
                                        "-----CONTINUED LAST RECORD WOULD SERIALIZE LIKE:");
                                    HexDump.dump(last_record.serialize(), 0,
                                                 System.out, 0);
                                    System.out.println();
                                    System.out.println(
                                        "-----CONTINUED----------------------------------");
                                }
                            }
                            else
                            {
                                last_record = record;
                                records.add(record);
                            }
                        }
                    }
                }
            }
            while (rectype != 0);
        }
        catch (IOException e)
        {
            throw new RecordFormatException("Error reading bytes");
        }
        Record[] retval = new Record[ records.size() ];

        retval = ( Record [] ) records.toArray(retval);
        return retval;
    }

