    private String formulaString(FormulaRecord record) {

        StringBuffer buf = new StringBuffer();
		Ptg[] tokens = record.getParsedExpression();
		for (int i = 0; i < tokens.length; i++) {
			Ptg token = tokens[i];
            buf.append( token.toFormulaString());
            switch (token.getPtgClass()) {
                case Ptg.CLASS_REF :
                    buf.append("(R)");
                    break;
                case Ptg.CLASS_VALUE :
                    buf.append("(V)");
                    break;
                case Ptg.CLASS_ARRAY :
                    buf.append("(A)");
                    break;
                default:
                    throwInvalidRVAToken(token);
            }
            buf.append(' ');
        } 
        return buf.toString();
    }

