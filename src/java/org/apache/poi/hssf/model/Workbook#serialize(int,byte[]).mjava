    /**
     * Serializes all records int the worksheet section into a big byte array. Use
     * this to write the Workbook out.
     * @param offset of the data to be written
     * @param data array of bytes to write this to
     */

    public int serialize(int offset, byte [] data) {
        log.log(DEBUG, "Serializing Workbook with offsets");

        // ArrayList bytes     = new ArrayList(records.size());
        //        int arraysize = getSize();   // 0;
        int pos       = 0;

        //        for (int k = 0; k < records.size(); k++)
        //        {
        //            bytes.add((( Record ) records.get(k)).serialize());
        //
        //        }
        //        for (int k = 0; k < bytes.size(); k++)
        //       {
        //            arraysize += (( byte [] ) bytes.get(k)).length;
        //        }
        for (int k = 0; k < records.size(); k++) {

            // byte[] rec = (( byte [] ) bytes.get(k));
            // System.arraycopy(rec, 0, data, offset + pos, rec.length);
            Record record = records.get(k);
            // Let's skip RECALCID records, as they are only use for optimization
            if(record.getSid() != RecalcIdRecord.sid || ((RecalcIdRecord)record).isNeeded()) {
		pos += record.serialize(pos + offset, data);   // rec.length;
            }
        }
        log.log(DEBUG, "Exiting serialize workbook");
        return pos;
    }

