    /**
     * Applies a font to the specified characters of a string.
     *
     * @param startIndex    The start index to apply the font to (inclusive)
     * @param endIndex      The end index to apply the font to (exclusive)
     * @param fontIndex     The font to use.
     */
    public void applyFont(int startIndex, int endIndex, short fontIndex)
    {
        if (startIndex > endIndex)
            throw new IllegalArgumentException("Start index must be less than end index.");
        if (startIndex < 0 || endIndex > length())
            throw new IllegalArgumentException("Start and end index not in range.");
        if (startIndex == endIndex)
            return;

        Integer from = new Integer(startIndex);
        Integer to = new Integer(endIndex);
        short fontAtIndex = NO_FONT;
        if (endIndex != length())
            fontAtIndex = getFontAtIndex(endIndex);
        formattingRuns.subMap(from, to).clear();
        formattingRuns.put(from, new Short(fontIndex));
        if (endIndex != length())
        {
            if (fontIndex != fontAtIndex)
                formattingRuns.put(to, new Short(fontAtIndex));
        }
    }

