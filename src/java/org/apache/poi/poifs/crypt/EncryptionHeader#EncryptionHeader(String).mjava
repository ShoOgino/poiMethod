    public EncryptionHeader(String descriptor) throws IOException {
        NamedNodeMap keyData;
        try {
            ByteArrayInputStream is;
            is = new ByteArrayInputStream(descriptor.getBytes());
            keyData = DocumentBuilderFactory.newInstance()
                .newDocumentBuilder().parse(is)
                .getElementsByTagName("keyData").item(0).getAttributes();
        } catch (Exception e) {
            throw new EncryptedDocumentException("Unable to parse keyData");
        }

        keySize = Integer.parseInt(keyData.getNamedItem("keyBits")
                                   .getNodeValue());
        flags = 0;
        sizeExtra = 0;
        cspName = null;

        blockSize = Integer.parseInt(keyData.getNamedItem("blockSize").
                                         getNodeValue());
        String cipher = keyData.getNamedItem("cipherAlgorithm").getNodeValue();

        if ("AES".equals(cipher)) {
            providerType = PROVIDER_AES;
            switch (keySize) {
              case 128: 
                algorithm = ALGORITHM_AES_128; break;
            case 192: 
                algorithm = ALGORITHM_AES_192; break;
            case 256: 
                algorithm = ALGORITHM_AES_256; break;
            default: 
                throw new EncryptedDocumentException("Unsupported key length " + keySize);
            }
        } else {
            throw new EncryptedDocumentException("Unsupported cipher " + cipher);
        }

        String chaining = keyData.getNamedItem("cipherChaining").getNodeValue();

        if ("ChainingModeCBC".equals(chaining))
            cipherMode = MODE_CBC;
        else if ("ChainingModeCFB".equals(chaining))
            cipherMode = MODE_CFB;
        else
            throw new EncryptedDocumentException("Unsupported chaining mode " + chaining);

        String hashAlg = keyData.getNamedItem("hashAlgorithm").getNodeValue();
        int hashSize = Integer.parseInt(
        		             keyData.getNamedItem("hashSize").getNodeValue());

        if ("SHA1".equals(hashAlg) && hashSize == 20) {
            hashAlgorithm = HASH_SHA1;
        }
        else if ("SHA256".equals(hashAlg) && hashSize == 32) {
            hashAlgorithm = HASH_SHA256;
        }
        else if ("SHA384".equals(hashAlg) && hashSize == 64) {
            hashAlgorithm = HASH_SHA384;
        }
        else if ("SHA512".equals(hashAlg) && hashSize == 64) {
            hashAlgorithm = HASH_SHA512;
        }
        else {
            throw new EncryptedDocumentException("Unsupported hash algorithm: " + 
                                                  hashAlg + " @ " + hashSize + " bytes");
        }

        String salt = keyData.getNamedItem("saltValue").getNodeValue();
        int saltLength = Integer.parseInt(keyData.getNamedItem("saltSize")
                                          .getNodeValue());
        keySalt = Base64.decodeBase64(salt.getBytes());
        if (keySalt.length != saltLength)
            throw new EncryptedDocumentException("Invalid salt length");
    }

