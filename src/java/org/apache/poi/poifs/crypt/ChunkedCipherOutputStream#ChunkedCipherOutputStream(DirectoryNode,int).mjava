    public ChunkedCipherOutputStream(DirectoryNode dir, int chunkSize) throws IOException, GeneralSecurityException {
        super(null);
        this.chunkSize = chunkSize;
        chunkMask = chunkSize-1;
        chunkBits = Integer.bitCount(chunkMask);
        _chunk = new byte[chunkSize];

        fileOut = TempFile.createTempFile("encrypted_package", "crypt");
        fileOut.deleteOnExit();
        this.out = new FileOutputStream(fileOut);
        this.dir = dir;
        _cipher = initCipherForBlock(null, 0, false);
    }

