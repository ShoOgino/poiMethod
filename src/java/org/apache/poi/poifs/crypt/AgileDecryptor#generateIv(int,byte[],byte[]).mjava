    protected byte[] generateIv(int algorithm, byte[] salt, byte[] blockKey)
        throws NoSuchAlgorithmException {


        if (blockKey == null)
            return getBlock(algorithm, salt);

        MessageDigest sha1 = MessageDigest.getInstance("SHA-1");
        sha1.update(salt);
        return getBlock(algorithm, sha1.digest(blockKey));
    }

