    public void testRemoveArrayFormula() throws Exception {
        XSSFCell[] cells;

        XSSFWorkbook workbook = new XSSFWorkbook();
        XSSFSheet sheet = workbook.createSheet();

        CellRangeAddress range = new CellRangeAddress(3, 5, 2, 2);
        assertEquals("C4:C6", range.formatAsString());
        cells = sheet.setArrayFormula("SUM(A1:A3*B1:B3)", range);
        assertEquals(3, cells.length);

        // remove the formula cells in C4:C6
        XSSFCell[] dcells = sheet.removeArrayFormula(cells[0]);
        // removeArrayFormula should return the same cells as setArrayFormula
        assertTrue(Arrays.equals(cells, dcells));

        for(XSSFCell acell : cells){
            assertFalse(acell.isPartOfArrayFormulaGroup());
            assertEquals(Cell.CELL_TYPE_BLANK, acell.getCellType());
        }

        //invocation on a not-array-formula cell throws IllegalStateException
        try {
            sheet.removeArrayFormula(cells[0]);
            fail("expected exception");
        } catch (IllegalArgumentException e){
            assertEquals("Cell C4 is not part of an array formula", e.getMessage());
        }
    }

