        @Override
        public void write(OutputStream stream) throws IOException {
            flushSheets();
            EncryptedTempData tempData = new EncryptedTempData();
            OutputStream os = tempData.getOutputStream();
            getXSSFWorkbook().write(os);
            os.close();
            ZipEntrySource source = null;
            try {
                // provide ZipEntrySource to poi which decrypts on the fly
                source = AesZipFileZipEntrySource.createZipEntrySource(tempData.getInputStream());
                injectData(source, stream);
            } catch (GeneralSecurityException e) {
                throw new IOException(e);
            } finally {
                IOUtils.closeQuietly(source);
            }
        }

