    public static <R extends Workbook> R writeOutAndReadBack(R wb) {
    	Workbook result;
		try {
            ByteArrayOutputStream baos = new ByteArrayOutputStream(8192);
            wb.write(baos);
            InputStream is = new ByteArrayInputStream(baos.toByteArray());
	    	if (wb instanceof HSSFWorkbook) {
	    		result = new HSSFWorkbook(is);
	    	} else if (wb instanceof XSSFWorkbook) {
    			result = new XSSFWorkbook(is);
	    	} else {
	    		throw new RuntimeException("Unexpected workbook type ("
	    				+ wb.getClass().getName() + ")");
	    	}
		} catch (IOException e) {
			throw new RuntimeException(e);
		}
		@SuppressWarnings("unchecked")
		R r = (R) result;
		return r;
    }

