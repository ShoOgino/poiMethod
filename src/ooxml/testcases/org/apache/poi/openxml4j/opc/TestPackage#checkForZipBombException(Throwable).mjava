    private void checkForZipBombException(Throwable e) {
    	// unwrap InvocationTargetException as they usually contain the nested exception in the "target" member
        if(e instanceof InvocationTargetException) {
			e = ((InvocationTargetException)e).getTargetException();
        }
        
        String msg = e.getMessage();
        if(msg != null && (msg.startsWith("Zip bomb detected!") ||
				msg.contains("The parser has encountered more than \"4,096\" entity expansions in this document;") ||
				msg.contains("The parser has encountered more than \"4096\" entity expansions in this document;"))) {
            return;
        }
        
        // recursively check the causes for the message as it can be nested further down in the exception-tree
        if(e.getCause() != null && e.getCause() != e) {
            checkForZipBombException(e.getCause());
            return;
        }

        throw new IllegalStateException("Expected to catch an Exception because of a detected Zip Bomb, but did not find the related error message in the exception", e);        
    }

