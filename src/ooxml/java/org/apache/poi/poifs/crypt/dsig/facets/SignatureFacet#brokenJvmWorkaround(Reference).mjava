    // helper method ... will be removed soon
    public static void brokenJvmWorkaround(final Reference reference) {
        final DigestMethod digestMethod = reference.getDigestMethod();
        final String digestMethodUri = digestMethod.getAlgorithm();
        
        final Provider bcProv = Security.getProvider("BC");
        if (bcProv != null && !DigestMethod.SHA1.equals(digestMethodUri)) {
            // workaround for https://bugzilla.redhat.com/show_bug.cgi?id=1155012
            // overwrite standard message digest, if a digest <> SHA1 is used
            AccessController.doPrivileged(new PrivilegedAction<Void>() {
                @Override
                @SuppressForbidden("Workaround for a bug, needs access to private JDK members (may fail in Java 9): https://bugzilla.redhat.com/show_bug.cgi?id=1155012")
                public Void run() {
                    try {
                        Method m = DOMDigestMethod.class.getDeclaredMethod("getMessageDigestAlgorithm");
                        m.setAccessible(true);
                        String mdAlgo = (String)m.invoke(digestMethod);
                        MessageDigest md = MessageDigest.getInstance(mdAlgo, bcProv);
                        Field f = DOMReference.class.getDeclaredField("md");
                        f.setAccessible(true);
                        f.set(reference, md);
                    } catch (Exception e) {
                        LOG.log(POILogger.WARN, "Can't overwrite message digest (workaround for https://bugzilla.redhat.com/show_bug.cgi?id=1155012)", e);
                    }
                    return null; // Void
                }
            });
        }
    }

