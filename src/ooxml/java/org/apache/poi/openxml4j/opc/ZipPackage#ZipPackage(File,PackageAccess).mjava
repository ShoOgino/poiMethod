    /**
     * Constructor. Opens a Zip based Open XML document from a File.
     *
     * @param file
     *            The file to open or create.
     * @param access
     *            The package access mode.
     */
    @SuppressWarnings("resource")
    ZipPackage(File file, PackageAccess access) {
        super(access);

        ZipEntrySource ze;
        try {
            final ZipFile zipFile = ZipHelper.openZipFile(file);
            ze = new ZipFileZipEntrySource(zipFile);
        } catch (IOException e) {
            // probably not happening with write access - not sure how to handle the default read-write access ...
            if (access == PackageAccess.WRITE) {
                throw new InvalidOperationException("Can't open the specified file: '" + file + "'", e);
            }
            logger.log(POILogger.ERROR, "Error in zip file "+file+" - falling back to stream processing (i.e. ignoring zip central directory)");
            // some zips can't be opened via ZipFile in JDK6, as the central directory
            // contains either non-latin entries or the compression type can't be handled
            // the workaround is to iterate over the stream and not the directory
            FileInputStream fis;
            try {
                fis = new FileInputStream(file);
                ThresholdInputStream zis = ZipHelper.openZipStream(fis);
                ze = new ZipInputStreamZipEntrySource(zis);
            } catch (IOException e2) {
                throw new InvalidOperationException("Can't open the specified file: '" + file + "'", e);
            }
        }
        this.zipArchive = ze;
    }

