    /**
     * Parse the relationship part and add all relationship in this collection.
     *
     * @param relPart
     *            The package part to parse.
     * @throws InvalidFormatException
     *             Throws if the relationship part is invalid.
     */
    private void parseRelationshipsPart(PackagePart relPart)
            throws InvalidFormatException {
        try {
            logger.log(POILogger.DEBUG, "Parsing relationship: " + relPart.getPartName());
            Document xmlRelationshipsDoc = SAXHelper.readSAXDocument(relPart.getInputStream());

            // Browse default types
            Element root = xmlRelationshipsDoc.getRootElement();

            // Check OPC compliance M4.1 rule
            boolean fCorePropertiesRelationship = false;

            @SuppressWarnings("unchecked")
            Iterator<Element> iter = (Iterator<Element>)
                root.elementIterator(PackageRelationship.RELATIONSHIP_TAG_NAME);
            while (iter.hasNext()) {
                Element element = iter.next();
                // Relationship ID
                String id = element.attribute(
                        PackageRelationship.ID_ATTRIBUTE_NAME).getValue();
                // Relationship type
                String type = element.attribute(
                        PackageRelationship.TYPE_ATTRIBUTE_NAME).getValue();

                /* Check OPC Compliance */
                // Check Rule M4.1
                if (type.equals(PackageRelationshipTypes.CORE_PROPERTIES))
                    if (!fCorePropertiesRelationship)
                        fCorePropertiesRelationship = true;
                    else
                        throw new InvalidFormatException(
                                "OPC Compliance error [M4.1]: there is more than one core properties relationship in the package !");

                /* End OPC Compliance */

                // TargetMode (default value "Internal")
                Attribute targetModeAttr = element
                        .attribute(PackageRelationship.TARGET_MODE_ATTRIBUTE_NAME);
                TargetMode targetMode = TargetMode.INTERNAL;
                if (targetModeAttr != null) {
                    targetMode = targetModeAttr.getValue().toLowerCase()
                            .equals("internal") ? TargetMode.INTERNAL
                            : TargetMode.EXTERNAL;
                }

                // Target converted in URI
                URI target = PackagingURIHelper.toURI("http://invalid.uri"); // dummy url
                String value = element.attribute(
                        PackageRelationship.TARGET_ATTRIBUTE_NAME)
                        .getValue();
                try {
                    // when parsing of the given uri fails, we can either
                    // ignore this relationship, which leads to IllegalStateException
                    // later on, or use a dummy value and thus enable processing of the
                    // package
                    target = PackagingURIHelper.toURI(value);
                } catch (URISyntaxException e) {
                    logger.log(POILogger.ERROR, "Cannot convert " + value
                            + " in a valid relationship URI-> dummy-URI used", e);
                }
                addRelationship(target, targetMode, type, id);
            }
        } catch (Exception e) {
            logger.log(POILogger.ERROR, e);
            throw new InvalidFormatException(e.getMessage());
        }
    }

