    private static POITextExtractor createEncryptedOOXMLExtractor(POIFSFileSystem fs)
    throws IOException {
        String pass = Biff8EncryptionKey.getCurrentUserPassword();
        if (pass == null) {
            pass = Decryptor.DEFAULT_PASSWORD;
        }
        
        EncryptionInfo ei = new EncryptionInfo(fs);
        Decryptor dec = ei.getDecryptor();
        InputStream is = null;
        try {
            if (!dec.verifyPassword(pass)) {
                throw new EncryptedDocumentException("Invalid password specified - use Biff8EncryptionKey.setCurrentUserPassword() before calling extractor");
            }
            is = dec.getDataStream(fs);
            return createExtractor(OPCPackage.open(is));
        } catch (IOException e) {
            throw e;
        } catch (Exception e) {
            throw new EncryptedDocumentException(e);
        } finally {
            IOUtils.closeQuietly(is);

            // also close the NPOIFSFileSystem here as we read all the data
            // while decrypting
            fs.close();
        }
    }

