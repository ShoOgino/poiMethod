    public static POITextExtractor createExtractor(InputStream inp) throws IOException, OpenXML4JException, XmlException {
        InputStream is = FileMagic.prepareToCheckMagic(inp);

        FileMagic fm = FileMagic.valueOf(is);

        switch (fm) {
        case OLE2:
            POIFSFileSystem fs = new POIFSFileSystem(is);
            boolean isEncrypted = fs.getRoot().hasEntry(Decryptor.DEFAULT_POIFS_ENTRY);
            return isEncrypted ? createEncryptedOOXMLExtractor(fs) : createExtractor(fs);
        case OOXML:
            return createExtractor(OPCPackage.open(is));
        default:
            throw new IllegalArgumentException("Your InputStream was neither an OLE2 stream, nor an OOXML stream, found type: " + fm);
        }
    }

