    /**
     * ensure that the array of CTRow written to CTSheetData is ordered by row index
     */
    private void ensureRowOrdering(){
        CTSheetData sheetData = worksheet.getSheetData();
        // check if row indexes in CTSheetData match the internal model:
        // rows in the internal model (_rows) are always ordered while
        // CTRow beans held by CTSheetData may be not, for example, user can
        // insert rows in random order, shift rows after insertion, etc.
        boolean isOrdered = true;
        if(sheetData.sizeOfRowArray() != _rows.size()) isOrdered = false;
        else {
            int i = 0;
            CTRow[] xrow = sheetData.getRowArray();
            for (XSSFRow row : _rows.values()) {
                CTRow c1 = row.getCTRow();
                CTRow c2 = xrow[i++];
                if (c1.getR() != c2.getR()){
                    isOrdered = false;
                    break;
                }
            }
        }
        
        if(!isOrdered){
            CTRow[] cArray = new CTRow[_rows.size()];
            int i = 0;
            for(XSSFRow row : _rows.values()){
                cArray[i++] = row.getCTRow();
            }
            sheetData.setRowArray(cArray);
        }
    }

