    private int resolveBookIndex(String bookName) {
        // Strip the [] wrapper, if still present
        if (bookName.startsWith("[") && bookName.endsWith("]")) {
            bookName = bookName.substring(1, bookName.length()-2);
        }

        // Is it already in numeric form?
        try {
            return Integer.parseInt(bookName);
        } catch (NumberFormatException e) {}

        // Look up an External Link Table for this name
        List<ExternalLinksTable> tables = _uBook.getExternalLinksTable();
        for (int i=0; i<tables.size(); i++) {
            if (tables.get(i).getLinkedFileName().equals(bookName)) {
                return i;
            }
        }
        throw new RuntimeException("Book not linked for filename " + bookName);
    }

