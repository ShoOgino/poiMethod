    void ensureTypeOrFormulaType(int type)
    {
        assert type==CELL_TYPE_NUMERIC||
               type==CELL_TYPE_STRING||
               type==CELL_TYPE_BOOLEAN||
               type==CELL_TYPE_ERROR;
        if(_value.getType()==type)
        {
            if(type==CELL_TYPE_STRING&&((StringValue)_value).isRichText())
                setType(CELL_TYPE_STRING);
            return;
        }
        if(_value.getType()==CELL_TYPE_FORMULA)
        {
            if(((FormulaValue)_value).getFormulaType()==type)
                return;
            setFormulaType(type); // once a formula, always a formula
            return;
        }
        setType(type);
    }

