    /**
     * Returns a formula evaluator that is loaded with the functions that
     * have been supplied.
     * 
     * @param excelFileName
     * @return
     */
    protected FormulaEvaluator getEvaluator( String excelFileName ) {
        FormulaEvaluator evaluator ;
        if (excelFileName.endsWith(".xlsx")) {
            if( xlsMacroList != null && xlsMacroList.size() > 0 ) {
                evaluator = XSSFFormulaEvaluator.create( (XSSFWorkbook) workbook,
                                                         null,
                                                         getFunctions() ) ;
            }
            evaluator = new XSSFFormulaEvaluator((XSSFWorkbook) workbook);
        } else {
            if( xlsMacroList != null && xlsMacroList.size() > 0 ) {
                evaluator = HSSFFormulaEvaluator.create( (HSSFWorkbook)workbook,
                                                         null,
                                                         getFunctions() ) ;
            }

            evaluator = new HSSFFormulaEvaluator((HSSFWorkbook) workbook);
        }

        return evaluator ;

    }

