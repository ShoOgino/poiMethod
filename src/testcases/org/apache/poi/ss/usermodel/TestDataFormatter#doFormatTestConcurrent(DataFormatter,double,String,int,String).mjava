    private void doFormatTestConcurrent(DataFormatter formatter, double n, String expected, int formatIndex,
                                        String formatString) throws Exception {
        ArrayList<CompletableFuture<Boolean>> futures = new ArrayList<>();
        for (int i = 0; i < 1_000; i++) {
            final int iteration = i;
            CompletableFuture<Boolean> future = CompletableFuture.supplyAsync(
                    () -> { return doFormatTest(formatter, n, expected, formatIndex, formatString, iteration); });
            futures.add(future);
        }
        for (CompletableFuture<Boolean> future : futures) {
            assertTrue(future.get(1, TimeUnit.MINUTES));
        }
    }

