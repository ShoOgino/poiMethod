	/**
	 * Sometimes a {@link StringRecord} appears after a {@link FormulaRecord} even though the
	 * formula has evaluated to a text value.  This might be more likely to occur when the formula
	 * <i>can</i> evaluate to a text value.<br/>
	 * Bug 46213 attachment 22874 has such an extra {@link StringRecord} at stream offset 0x5765.
	 * This file seems to open in Excel (2007) with no trouble.  When it is re-saved, Excel omits
	 * the extra record.  POI should do the same.
	 */
	public void testExtraStringRecord_bug46213() {
		FormulaRecord fr = new FormulaRecord();
		fr.setValue(2.0);
		StringRecord sr = new StringRecord();
		sr.setString("NA");
		SharedValueManager svm = SharedValueManager.EMPTY;
		FormulaRecordAggregate fra;
		
		try {
			fra = new FormulaRecordAggregate(fr, sr, svm);
		} catch (RecordFormatException e) {
			if ("String record was  supplied but formula record flag is not  set".equals(e.getMessage())) {
				throw new AssertionFailedError("Identified bug 46213");
			}
			throw e;
		}
		RecordCollector rc = new RecordCollector();
		fra.visitContainedRecords(rc);
		Record[] vraRecs = rc.getRecords();
		assertEquals(1, vraRecs.length);
		assertEquals(fr, vraRecs[0]);
	}

