	private int runWithDir(String dir) throws IOException {
		List<String> failed = new ArrayList<String>();

		String[] files = new File(dir).list(new FilenameFilter() {
			public boolean accept(File arg0, String arg1) {
				return arg1.toLowerCase().endsWith(".xls");
			}
		});
		
		assertNotNull("Did not find any xls files in directory " + dir, files);
		
		runWithArrayOfFiles(files, dir, failed);

		assertTrue("Expected to have no failed except the ones excluded, but had: " + failed, 
				failed.isEmpty());
		
		return files.length;
	}

