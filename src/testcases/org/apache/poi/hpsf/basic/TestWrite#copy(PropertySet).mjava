    /**
     * <p>Creates a copy of a {@link PropertySet}.</p>
     *
     * @param ps the property set to copy
     * @return the copy
     */
    private MutablePropertySet copy(final PropertySet ps)
    {
        MutablePropertySet copy = new MutablePropertySet();
        copy.setByteOrder(ps.getByteOrder());
        copy.setClassID(ps.getClassID());
        copy.setFormat(ps.getFormat());
        copy.setOSVersion(ps.getOSVersion());
        copy.clearSections();

        /* Copy the sections. */
        for (final Iterator i1 = ps.getSections().iterator(); i1.hasNext();)
        {
            final Section s1 = (Section) i1.next();
            final MutableSection s2 = new MutableSection();
            s2.setFormatID(s1.getFormatID());

            /* Copy the properties. */
            final Property[] pa = s1.getProperties();
            for (int i2 = 0; i2 < pa.length; i2++)
            {
                final Property p1 = pa[i2];
                final MutableProperty p2 = new MutableProperty();
                p2.setID(p1.getID());
                p2.setType(p1.getType());
                p2.setValue(p1.getValue());
                s2.setProperty(p2);
            }
            copy.addSection(s2);
        }
        return copy;
    }

