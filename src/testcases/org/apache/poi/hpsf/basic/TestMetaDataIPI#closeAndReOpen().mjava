 /**
  * Closes the ByteArrayOutputStream and reads it into a ByteArrayInputStream.
  * When finished writing information this method is used in the tests to
  * start reading from the created document and then the see if the results match.
  *
  */
  public void closeAndReOpen(){
	     
	     try {
			dsi.write(dir, DocumentSummaryInformation.DEFAULT_STREAM_NAME);
			si.write(dir,SummaryInformation.DEFAULT_STREAM_NAME);
		} catch (WritingNotSupportedException e) {
			e.printStackTrace();
			fail();
		} catch (IOException e) {
			e.printStackTrace();
			fail();
		}

        si=null;
        dsi=null;
		try {
			
			poifs.writeFilesystem(bout);
			bout.flush();
			
		} catch (IOException e) {

			e.printStackTrace();
			fail();
		}
	     
	     InputStream is=new ByteArrayInputStream(bout.toByteArray());
	   assertNotNull(is);
	   POIFSFileSystem poifs=null;
		try {
			poifs = new POIFSFileSystem(is);
		} catch (IOException e) {

			e.printStackTrace();
			fail();
		}
	     try {
			is.close();
		} catch (IOException e) {
			e.printStackTrace();
			fail();
		}
	    assertNotNull(poifs);
	     /* Read the document summary information. */
	     DirectoryEntry dir = poifs.getRoot();
	     
	     try
	     {
	         DocumentEntry dsiEntry = (DocumentEntry)
	             dir.getEntry(DocumentSummaryInformation.DEFAULT_STREAM_NAME);
	         DocumentInputStream dis = new DocumentInputStream(dsiEntry);
	         PropertySet ps = new PropertySet(dis);
	         dis.close();
	         dsi = new DocumentSummaryInformation(ps);
	     }
	     catch (FileNotFoundException ex)
	     {
	         fail();
	     } catch (IOException e) {
			e.printStackTrace();
			fail();
		} catch (NoPropertySetStreamException e) {
			e.printStackTrace();
			fail();
		} catch (MarkUnsupportedException e) {
			e.printStackTrace();
			fail();
		} catch (UnexpectedPropertySetTypeException e) {
			e.printStackTrace();
			fail();
		}
		  try
		    {
		        DocumentEntry dsiEntry = (DocumentEntry)
		            dir.getEntry(SummaryInformation.DEFAULT_STREAM_NAME);
		        DocumentInputStream dis = new DocumentInputStream(dsiEntry);
		        PropertySet ps = new PropertySet(dis);
		        dis.close();
		        si = new SummaryInformation(ps);
		      
		        
		    }
		    catch (FileNotFoundException ex)
		    {
		        /* There is no document summary information yet. We have to create a
		         * new one. */
		        si = PropertySetFactory.newSummaryInformation();
		        assertNotNull(si);
		    } catch (IOException e) {
				e.printStackTrace();
				fail();
			} catch (NoPropertySetStreamException e) {
				e.printStackTrace();
				fail();
			} catch (MarkUnsupportedException e) {
				e.printStackTrace();
				fail();
			} catch (UnexpectedPropertySetTypeException e) {
				e.printStackTrace();
				fail();
			}
  }

