  public String text()
    throws UnsupportedEncodingException
  {
    initText();

    StringBuffer sb = new StringBuffer();
    int size = _text.size();
    for (int x = 0; x < size; x++)
    {
      TextPiece tp = (TextPiece)_text.get(x);
      StringBuffer pieceSb = (StringBuffer)tp.getCacheContents();
      if (pieceSb == null)
      {
        String encoding = "Cp1252";
        if (tp.usesUnicode())
        {
          encoding = "UTF-16LE";
        }
        String str = new String(tp.getBuf(), encoding);
        pieceSb = new StringBuffer(str);
        tp.fillCache(pieceSb);
      }
      int startIndex = Math.max(0, (tp.getStart() - _start));
      int endIndex = Math.min(tp.getEnd() - startIndex, _end - startIndex);
      sb.append(pieceSb.toString().substring(startIndex, endIndex));
    }
    return sb.toString();
  }

