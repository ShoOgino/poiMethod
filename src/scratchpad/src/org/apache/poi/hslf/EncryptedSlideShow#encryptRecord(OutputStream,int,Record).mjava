    protected OutputStream encryptRecord(OutputStream plainStream, int persistId, Record record) {
        boolean isPlain = (dea == null 
            || record instanceof UserEditAtom
            || record instanceof PersistPtrHolder
            || record instanceof DocumentEncryptionAtom
        );
        if (isPlain) return plainStream;

        encryptInit();
        setPersistId(persistId);
        
        if (cyos == null) {
            cyos = new CipherOutputStream(plainStream, cipher);
        }
        return cyos;
    }

