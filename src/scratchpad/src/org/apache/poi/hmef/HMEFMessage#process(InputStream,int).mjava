   private void process(InputStream inp, int lastLevel) throws IOException {
      // Fetch the level
      int level = inp.read();
      if(level == TNEFProperty.LEVEL_END_OF_FILE) {
         return;
      }
    
      // Build the attribute
      TNEFAttribute attr = TNEFAttribute.create(inp);
      
      // Decide what to attach it to, based on the levels and IDs
      if(level == TNEFProperty.LEVEL_MESSAGE) {
         messageAttributes.add(attr);
         
         if(attr instanceof TNEFMAPIAttribute) {
            TNEFMAPIAttribute tnefMAPI = (TNEFMAPIAttribute)attr;
            mapiAttributes.addAll( tnefMAPI.getMAPIAttributes() );
         }
      } else if(level == TNEFProperty.LEVEL_ATTACHMENT) {
         // Previous attachment or a new one?
         if(attachments.size() == 0 || attr.getProperty() == TNEFProperty.ID_ATTACHRENDERDATA) {
            attachments.add(new Attachment());
         }
         
         // Save the attribute for it
         Attachment attach = attachments.get(attachments.size()-1);
         attach.addAttribute(attr);
      } else {
         throw new IllegalStateException("Unhandled level " + level);
      }
      
      // Handle the next one down
      process(inp, level);
   }

