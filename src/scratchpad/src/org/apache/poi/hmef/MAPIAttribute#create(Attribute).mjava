   /**
    * Parses a MAPI Properties TNEF Attribute, and returns
    *  the list of MAPI Attributes contained within it
    */
   public static List<MAPIAttribute> create(Attribute parent) throws IOException {
      if(parent.getId() != Attribute.ID_MAPIPROPERTIES) {
         throw new IllegalArgumentException(
               "Can only create from a MAPIProperty attribute, " +
               "instead received a " + parent.getId() + " one"
         );
      }
      ByteArrayInputStream inp = new ByteArrayInputStream(parent.getData());
      
      // First up, get the number of attributes
      int count = LittleEndian.readInt(inp);
      List<MAPIAttribute> attrs = new ArrayList<MAPIAttribute>();
      
      // Now, read each one in in turn
      for(int i=0; i<count; i++) {
         int typeAndMV = LittleEndian.readUShort(inp);
         int id = LittleEndian.readUShort(inp);
         
         // Is it either Multi-Valued or Variable-Length?
         boolean isMV = false;
         boolean isVL = false;
         int type = typeAndMV;
         if( (typeAndMV & Types.MULTIVALUED_FLAG) > 0 ) {
            isMV = true;
            type -= Types.MULTIVALUED_FLAG;
         }
         if(type == Types.ASCII_STRING || type == Types.UNICODE_STRING ||
               type == Types.BINARY || type == Types.DIRECTORY) {
            isVL = true;
         }
         
         // If it's a named property, rather than a standard
         //  MAPI property, grab the details of it
         MAPIProperty prop = MAPIProperty.get(id);
         if(id >= 0x8000 && id <= 0xFFFF) {
            // TODO
            throw new UnsupportedOperationException("Not yet implemented for id " + id);
         }
         
         // Now read in the value(s)
         int values = 1;
         if(isMV || isVL) {
            values = LittleEndian.readInt(inp);
         }
         for(int j=0; j<values; j++) {
            int len = getLength(type, inp);
            byte[] data = new byte[len];
            IOUtils.readFully(inp, data);
            
            // Create
            MAPIAttribute attr;
            if(type == Types.UNICODE_STRING || type == Types.ASCII_STRING) {
               attr = new MAPIStringAttribute(prop, type, data);
            } else {
               attr = new MAPIAttribute(prop, type, data);
            }
            attrs.add(attr);
            
            // Data is always padded out to a 4 byte boundary
            if(len % 4 != 0) {
               byte[] padding = new byte[len % 4];
               IOUtils.readFully(inp, padding);
            }
         }
         break;
      }
      
      // All done
      return attrs;
   }

