    @Test
    public void cryptoAPIChangeKeySize() throws Exception {
        String pptFile = "cryptoapi-proc2356.ppt";
        Biff8EncryptionKey.setCurrentUserPassword("crypto");
        NPOIFSFileSystem fs = new NPOIFSFileSystem(slTests.getFile(pptFile), true);
        HSLFSlideShow hss = new HSLFSlideShow(fs);
        // need to cache data (i.e. read all data) before changing the key size
        PictureData picsExpected[] = hss.getPictures();
        hss.getDocumentSummaryInformation();
        EncryptionInfo ei = hss.getDocumentEncryptionAtom().getEncryptionInfo();
        ((CryptoAPIEncryptionHeader)ei.getHeader()).setKeySize(0x78);
        
        ByteArrayOutputStream bos = new ByteArrayOutputStream();
        hss.write(bos);
        fs.close();
        
        fs = new NPOIFSFileSystem(new ByteArrayInputStream(bos.toByteArray()));
        hss = new HSLFSlideShow(fs);
        PictureData picsActual[] = hss.getPictures();
        fs.close();
        
        assertEquals(picsExpected.length, picsActual.length);
        for (int i=0; i<picsExpected.length; i++) {
            assertArrayEquals(picsExpected[i].getRawData(), picsActual[i].getRawData());
        }
    }

