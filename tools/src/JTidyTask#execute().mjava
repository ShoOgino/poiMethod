    /**
     * Run the task.
     * @exception org.apache.tools.ant.BuildException The exception raised during task execution.
     */

    public void execute()
        throws org.apache.tools.ant.BuildException
    {
        try
        {
            PrintWriter pw = new PrintWriter(new FileWriter(log));

            tidy.setErrout(pw);

            // Extract the document using JTidy and stream it.
            BufferedInputStream  in     =
                new BufferedInputStream(new FileInputStream(src));

            // FileOutputStream out = new FileOutputStream(dest);
            PrintWriter          out    =
                new PrintWriter(new FileWriter(dest));

            // using null as output to get dom so to remove duplicate attributes
            org.w3c.dom.Document domDoc = tidy.parseDOM(in, null);

            domDoc.normalize();
            stripDuplicateAttributes(domDoc, null);
            org.apache.xml.serialize.OutputFormat format =
                new org.apache.xml.serialize.OutputFormat();

            format.setIndenting(true);
            format.setEncoding("ISO-8859-1");
            format.setPreserveSpace(true);
            format.setLineSeparator("\n");
            org.apache.xml.serialize.XMLSerializer serializer =
                new org.apache.xml.serialize.XMLSerializer(out, format);

            serializer.serialize(domDoc);
            out.flush();
            out.close();
            in.close();
            pw.flush();
            pw.close();
        }
        catch (IOException ioe)
        {
            throw new BuildException(ioe);
        }
    }

