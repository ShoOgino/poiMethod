    /**
     * Add entry to sitemap
     */

    private void add(final String sitemapLocation, final String category,
                     final String componentName, final String className,
                     final String configuration, final String label,
                     final String mimeType)
        throws IOException
    {
        final String data             = load(sitemapLocation);
        final String searchString     =
            new StringBuffer("</map:").append(category).append(">")
                .toString();
        final int    pos              = data.indexOf(searchString);
        int          categoryStartPos =
            data
            .indexOf(new StringBuffer("<map:").append(category).append(">")
                .toString());

        if (categoryStartPos == -1)
        {
            categoryStartPos =
                data
                .indexOf(new StringBuffer("<map:").append(category)
                    .append(" ").toString());
        }
        if ((categoryStartPos != -1) && (categoryStartPos < pos)
                && (pos != -1))
        {

            // the category exists, now search if a component
            // with the name already exists
            int componentPos =
                data.substring(categoryStartPos, pos)
                    .indexOf(new StringBuffer("name=\"").append(componentName)
                        .append("\"").toString());

            if (componentPos == -1)
            {
                StringBuffer buffer =
                    new StringBuffer(data.substring(0, pos)).append("<map:")
                        .append(category.substring(0, category.length() - 1))
                        .append(" name=\"").append(componentName)
                        .append("\" src=\"").append(className).append("\"")
                        .append(" logger=\"sitemap.")
                        .append(category.substring(0, category.length() - 1))
                        .append('.').append(componentName).append('\"');

                if ((null != mimeType) && (mimeType.length() > 0))
                {
                    buffer.append(" mime-type=\"").append(mimeType)
                        .append("\"");
                }
                if ((null != label) && (label.length() > 0))
                {
                    buffer.append(" label=\"").append(label).append("\"");
                }
                if (null != configuration)
                {
                    buffer.append(">\n").append(configuration).append("\n")
                        .append("</map:")
                        .append(category.substring(0, category.length() - 1))
                        .append(">\n");
                }
                else
                {
                    buffer.append("/>\n");
                }
                buffer.append(data.substring(pos)).toString();
                this.save(sitemapLocation, buffer.toString());
            }
        }
    }

