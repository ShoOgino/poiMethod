    public void testSelect() throws XmlException
    {
        String uri = "http://xml.apache.org/test/selectChldAtt";

        String xml = "<doc xmlns='" + uri + "'>\n" +
            "  <int>7</int>\n" +
            "  <string> ... some text ... </string>\n" +

            "  <elemA price='4.321'>\n" +
            "    <topLevelElement> this is wildcard bucket </topLevelElement>\n" +
            "  </elemA>\n" +

            "  <elemB xmlns:p='uri:other_namespace' \n" +
            "       p:att='attribute in #other namespace'>\n" +
            "    <someElement>2</someElement>\n" +
            "    <p:otherElement> element in #other namespace </p:otherElement>\n" +
            "  </elemB>\n" +

            "  <elemC xmlns:xsi='" + XSI_URI + "' \n" +
            "         xmlns:p='uri_other_namespace' \n" +
            "         xsi:type='typeExtendedC' \n" +
            "         att1='attribute from typeC' \n" +
            "         aditionalAtt='attribute added in type extension' \n" +
            "         p:validAtt='attribute in any bucket' >\n" +
            "    <someElement> element from typeC </someElement>\n" +
            "    <p:validElement> element in the 'any' bucket for typeExtendedC </p:validElement>\n" +
            "    <aditionalElement> element from typeExtendedC </aditionalElement>\n" +
            "  </elemC>\n" +
            "</doc>";

        DocDocument document = DocDocument.Factory.parse(xml);
        DocDocument.Doc doc = document.getDoc();
        Collection errors = new ArrayList();
        Assert.assertTrue("Valid instance", doc.validate(new XmlOptions().setErrorListener(errors)));
        printErrors(errors);

        XmlObject xo;
        XmlObject[] xos;

        // select a known element
        xos = doc.selectChildren(new QName(uri, "int"));
        //print("1 selectChildren 'int' : ", xos);
        Assert.assertTrue("1 selectChildren 'int' : ", verifyResult(xos, new String[]{"<xml-fragment>7</xml-fragment>"}));

        xos = doc.selectChildren(uri, "string");
        //print("2 selectChildren 'string' : ", xos);
        Assert.assertTrue("2 selectChildren 'string' : ", verifyResult(xos, new String[]{"<xml-fragment>... some text ...</xml-fragment>"}));

        // elemA
        xos = doc.selectChildren(new QName(uri, "elemA"));
        //print("3 selectChildren 'elemA' : ", xos);
        Assert.assertTrue("3 selectChildren 'elemA' : ",
            verifyResult(xos, new String[]{"<xml-fragment price=\"4.321\" xmlns:sel=\"" + uri +"\">\n" +
            "  <sel:topLevelElement>this is wildcard bucket</sel:topLevelElement>\n" +
            "</xml-fragment>"}));

        // select a known attribute
        xo = xos[0].selectAttribute(new QName("", "price"));
        //print("4     selectAttribute 'price' : ", xo);
        Assert.assertTrue("4     selectAttribute 'price' : ",
            verifyResult(xo, "<xml-fragment>4.321</xml-fragment>"));

        // select all attributes
        QNameSet qns = QNameSet.forWildcardNamespaceString("##any", uri);
        xos = xos[0].selectAttributes(qns);
        //print("5     selectAttributes set'##any' :", xos);
        Assert.assertTrue("5     selectAttributes set'##any' :",
            verifyResult(xos, new String[]{"<xml-fragment>4.321</xml-fragment>"}));

        // elemB
        xos = doc.selectChildren(new QName(uri, "elemB"));
        //print("6 selectChildren 'elemB' : ", xos);

        //print("7     selectChildren set'##other' : " , xos[0].selectChildren(QNameSet.forWildcardNamespaceString("##other", uri)));
        Assert.assertTrue("7     selectChildren set'##other' : ",
            verifyResult( xos[0].selectChildren(QNameSet.forWildcardNamespaceString("##other", uri))
            , new String[]{"<xml-fragment xmlns:p=\"uri:other_namespace\">element in #other namespace</xml-fragment>"}));
        //print("8     selectAttributes set'##other' : ", xos[0].selectAttributes(QNameSet.forWildcardNamespaceString("##other", uri)));
        Assert.assertTrue("8     selectAttributes set'##other' : ",
            verifyResult(xos[0].selectAttributes(QNameSet.forWildcardNamespaceString("##other", uri)),
            new String[]{"<xml-fragment xmlns:p=\"uri:other_namespace\">attribute in #other namespace</xml-fragment>"}));

        // elemC
        xos = doc.selectChildren(new QName(uri, "elemC"));
        //print("9 selectChildren 'elemC' : ", xos);
        //print("10    selectChildren set'##any' : " , xos[0].selectChildren(QNameSet.forWildcardNamespaceString("##any", uri)));
        Assert.assertTrue("10    selectChildren set'##any' : ",
            verifyResult(xos[0].selectChildren(QNameSet.forWildcardNamespaceString("##any", uri))
            , new String[]{"<xml-fragment xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:p=\"uri_other_namespace\">element from typeC</xml-fragment>",
            "<xml-fragment xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:p=\"uri_other_namespace\">element in the 'any' bucket for typeExtendedC</xml-fragment>",
            "<xml-fragment xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:p=\"uri_other_namespace\">element from typeExtendedC</xml-fragment>"}));

        // select elements in the any bucket by excluding the the known elements
        QNameSetBuilder qnsb = new QNameSetBuilder();
        qnsb.add(new QName(uri, "someElement"));
        qnsb.add(new QName(uri, "aditionalElement"));
        qnsb.invert();

        //print("11a    selectChildren in the any bucket for typeExtendedC: " , xos[0].selectChildren(qnsb.toQNameSet()));
        Assert.assertTrue("11a    selectChildren in the any bucket for typeExtendedC: ",
            verifyResult(xos[0].selectChildren(qnsb.toQNameSet()),
            new String[]{"<xml-fragment xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:p=\"uri_other_namespace\">element in the 'any' bucket for typeExtendedC</xml-fragment>"}));

        //print("11b    selectChildren in the any bucket for typeExtendedC: " , xos[0].selectChildren(TypeExtendedC.type.qnameSetForWildcardElements()));
        Assert.assertTrue("11b    selectChildren in the any bucket for typeExtendedC: ",
            verifyResult(xos[0].selectChildren(TypeExtendedC.type.qnameSetForWildcardElements()),
            new String[]{"<xml-fragment xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:p=\"uri_other_namespace\">element in the 'any' bucket for typeExtendedC</xml-fragment>"}));

        // select attributes in the any bucket by excluding the the known attributes
        qnsb = new QNameSetBuilder();
        qnsb.add(new QName("", "att1"));
        qnsb.add(new QName("", "aditionalAtt"));
        qnsb.add(new QName(XSI_URI, "type"));
        qnsb.invert();

        //print("12a    selectChildren in the any bucket for typeExtendedC: " , xos[0].selectAttributes(qnsb.toQNameSet()));
        Assert.assertTrue("12a    selectChildren in the any bucket for typeExtendedC: ",
            verifyResult(xos[0].selectAttributes(qnsb.toQNameSet()),
            new String[]{"<xml-fragment xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:p=\"uri_other_namespace\">attribute in any bucket</xml-fragment>"}));
        //print("12b    selectChildren in the any bucket for typeExtendedC: " , xos[0].selectAttributes(TypeExtendedC.type.qnameSetForWildcardAttributes()));
        Assert.assertTrue("12b    selectChildren in the any bucket for typeExtendedC: ",
            verifyResult(xos[0].selectAttributes(TypeExtendedC.type.qnameSetForWildcardAttributes()),
            new String[]{"<xml-fragment xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:p=\"uri_other_namespace\">typeExtendedC</xml-fragment>",
            "<xml-fragment xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:p=\"uri_other_namespace\">attribute in any bucket</xml-fragment>"}));
    }

