    public void testFunction() throws Exception {
        String query = " declare function local:summary($emps as element(employee)*) \n" +
                "   as element(dept)*\n" +
                "{\n" +
                "   for $d in fn:distinct-values($emps/deptno)\n" +
                "   let $e := $emps[deptno = $d]\n" +
                "   return\n" +
                "      <dept>\n" +
                "         <deptno>{$d}</deptno>\n" +
                "         <headcount> {fn:count($e)} </headcount>\n" +
                "         <payroll> {fn:sum($e/salary)} </payroll>\n" +
                "      </dept>\n" +
                "};\n" +
                "\n" +
                //"local:summary($this//employee[location = \"Denver\"])";
                "local:summary(.//employee[location = \"Denver\"])";

        String xml = " <list>" +
                "<employee>" +
                "<location>Denver</location>" +
                "<deptno>7</deptno>" +
                "<salary>20</salary>" +
                "</employee>" +
                "<employee>" +
                "<location>Seattle</location>" +
                "<deptno>6</deptno>" +
                "<salary>30</salary>" +
                "</employee>" +
                "<employee>" +
                "<location>Denver</location>" +
                "<deptno>5</deptno>" +
                "<salary>40</salary>" +
                "</employee>" +
                "<employee>" +
                "<location>Denver</location>" +
                "<deptno>7</deptno>" +
                "<salary>10</salary>" +
                "</employee>" +
                "</list>";

        XmlObject o = XmlObject.Factory.parse(xml);
        XmlObject[] res = o.execQuery(query);
        assertEquals(2, res.length);
        assertEquals("<dept><deptno>7</deptno><headcount>2</headcount><payroll>30</payroll></dept>",
                res[0].xmlText());
        assertEquals("<dept><deptno>5</deptno><headcount>1</headcount><payroll>40</payroll></dept>",
                res[1].xmlText());
        XmlCursor c = o.newCursor();
        XmlCursor c1 = c.execQuery(query);
        c1.toFirstContentToken();
        assertEquals(res[0].xmlText(),
                c1.xmlText());
        c1.dispose();
        c.dispose();
    }

