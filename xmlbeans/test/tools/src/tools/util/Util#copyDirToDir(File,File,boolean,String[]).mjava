    /**
     * Recursively copy a dir to a new dir. Creates target tree if needed.
     */
    public static void copyDirToDir(File fromDir, File toDir,
                                    boolean replaceNewer, final String[] exclude)
            throws IOException
    {
        //System.out.println("copyDirToDir(fromDir=" + fromDir +
        //",\n toDir=" + toDir + ")");

        File[] fs = fromDir.listFiles();
        COPY_FILE_LOOP:
        for (int i = 0; i < fs.length; i++)
        {
            // exclude based only on last part of file name
            String name = fs[i].getName();

            if (exclude != null)
            {
                for (int j = 0; j < exclude.length; ++j)
                {
                    if (name.equals(exclude[j]))
                        continue COPY_FILE_LOOP;
                }
            }

            if (fs[i].isFile())
            {
                copyToDir(fs[i], toDir, replaceNewer);
            } else
            {
                copyDirToDir(fs[i], new File(toDir, fs[i].getName()),
                             replaceNewer, exclude);
            }
        }
    }

