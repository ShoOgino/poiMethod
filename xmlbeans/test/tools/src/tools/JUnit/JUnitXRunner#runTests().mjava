    public int runTests() {
        collectTests();
        Iterator itr = tests.iterator();

        TestResult res = new TestResult();
        res.addListener(_listener);

        try {
            if (outFile != null) {
                FileOutputStream fos = new FileOutputStream(new File(outFile));
                _listener.setOutput(fos);
            }
        }
        catch (FileNotFoundException fnfe) {
            throw new RuntimeException("Unable to initialize output to file "
                    + outFile + "\n" + fnfe.getMessage());
        }
       
        _listener.showTestOutput(showOutput);
        _listener.startRun();
        while (itr.hasNext()) {
            Test test = (Test) itr.next();
            test.run(res);
        }
        _listener.endRun();
        return res.failureCount();
    }

