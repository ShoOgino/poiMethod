    /**
     * Creates the TestResultDocument and returns the Xml as a string
     */
    private TestResultType getTestResultType(TestRecord rec)
    {
        TestResultType tr = TestResultType.Factory.newInstance();
        // Children of TestResult
        TestResultType.TestCase tc = tr.addNewTestCase();
        TestResultType.ExecutionOutput exo = tr.addNewExecutionOutput();

        // Set the logical test name... 'Class.Methodname'
        tr.setLogicalname(rec.getTestLogicalName());
        // Set the test Start time as a String
        tr.setExectime(new java.util.Date(rec.getStartTime()).toString());
        String status = rec.getStatusString();
        // Set the test result
        if (status.equals("SUCCESS"))
            tr.setResult(TestResultType.Result.SUCCESS);
        else
            tr.setResult(TestResultType.Result.FAILURE);
        // Set the test execution time.. in milliseconds
        String dur = Long.toString(rec.getEndTime() - rec.getStartTime());
        tr.setDuration(dur);
        // Set the completion status..
        tr.setIsdone(TestResultType.Isdone.TRUE);

        // Setup the children elements
        // test-case
        tc.setTestcasename(rec.getTestLogicalName());
        tc.setTestunit(rec.getTestUnitName());
        // This should ideally be the whole path to the class...
        tc.setTestpath(rec.getTestname());

        // execution-output
        // if FAILURE.. set erroname attribute
        if (rec.isFailure())
        {
            String exp = rec.getThrowable().toString();
            int index = exp.indexOf(":");
            // the above line is very flaky..
            if (index < 0) index = exp.length();
            exo.setErrorname(exp.substring(0, index));
        }
        StringBuffer output = new StringBuffer();
        String eol = System.getProperty("line.separator");
        output.append("[STDOUT]").append(eol);
        output.append(rec.getSysout()).append(eol);
        output.append("[STDERR]").append(eol);
        output.append(rec.getSyserr()).append(eol);
        if (rec.isFailure())
        {
            output.append("[EXCEPTION]").append(eol);
            output.append(JUnitTestRunner.getFilteredTrace(rec.getThrowable()));
        }

        exo.setOutputDetails(output.toString());

        return tr;
    }

