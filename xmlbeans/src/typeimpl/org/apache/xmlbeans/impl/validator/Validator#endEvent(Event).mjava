    private void endEvent ( Event event )
    {
        _localElement = null;
        _wildcardElement = null;
        State state = topState();

        if (!state._isNil)
        {
            if (!state.end())
            {
                findDetailedErrorEnd(event,state);
            }

            // This end event has no text, use this fact to pass no text to
            // handleText

            if (state._isEmpty)
                handleText( event, true, state._field );
        }

        popState( event );

        _constraintEngine.endElement( event );
    }

