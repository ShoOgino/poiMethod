    /* package */ static int julianDateForGDate(GDateSpecification date)
    {
        if (!date.hasDate())
            throw new IllegalStateException("cannot do date math without a complete date");

        // from http://aa.usno.navy.mil/faq/docs/JD_Formula.html
        int day = date.getDay();
        int month = date.getMonth();
        int year = date.getYear();
        year = (year > 0 ? year : year + 1);
        int result = day-32075+1461*(year+4800+(month-14)/12)/4+
            367*(month-2-(month-14)/12*12)/12-3*((year+4900+(month-14)/12)/100)/4;

        if (result < 0)
            throw new IllegalStateException("date too far in the past (year allowed to -4713)");

        return result;
    }

