    private final void processElement ( )
    {
        assert _cur.isElem() && _cur.getName() != null;

        QName name = _cur.getName();

        // Add a new entry to the frontier.  If this element has a name
        // which has no namespace, then we must make sure that pushing
        // the mappings causes the default namespace to be empty

        boolean ensureDefaultEmpty = name.getNamespaceURI().length() == 0;

        pushMappings( _cur, ensureDefaultEmpty );

        //
        // There are four things which use mappings:
        //
        //   1) The element name
        //   2) The element value (qname based)
        //   3) Attribute names
        //   4) The attribute values (qname based)
        //

        // 1) The element name (not for starts)

        ensureMapping( name.getNamespaceURI(), name.getPrefix(), !ensureDefaultEmpty, false );

        //
        //
        //

        _attrNames.clear();
        _attrValues.clear();

        _cur.push();

        attrs:
        for ( boolean A = _cur.toFirstAttr() ; A ; A = _cur.toNextAttr() )
        {
            if (_cur.isNormalAttr())
            {
                QName attrName = _cur.getName();

                _attrNames.add( attrName );

                for ( int i = _attrNames.size() - 2 ; i >= 0 ; i-- )
                {
                    if (_attrNames.get( i ).equals( attrName ))
                    {
                        _attrNames.remove( _attrNames.size() - 1 );
                        continue attrs;
                    }
                }

                _attrValues.add( _cur.getAttrValue() );

                ensureMapping( attrName.getNamespaceURI(), attrName.getPrefix(), false, true );
            }
        }

        _cur.pop();

        // If I am doing aggressive namespaces and we're emitting a
        // container which can contain content, add the namespaces
        // we've computed.  Basically, I'm making sure the pre-computed
        // namespaces are mapped on the first container which has a name.

        if (_preComputedNamespaces != null)
        {
            for ( Iterator i = _preComputedNamespaces.keySet().iterator() ; i.hasNext() ; )
            {
                String uri = (String) i.next();
                String prefix = (String) _preComputedNamespaces.get( uri );
                boolean considerDefault = prefix.length() == 0 && !ensureDefaultEmpty;

                ensureMapping( uri, prefix, considerDefault, false );
            }

            // Set to null so we do this once at the top
            _preComputedNamespaces = null;
        }

        if (emitElement( _cur, _attrNames, _attrValues ))
        {
            popMappings();
            _cur.toEnd();
        }
    }

