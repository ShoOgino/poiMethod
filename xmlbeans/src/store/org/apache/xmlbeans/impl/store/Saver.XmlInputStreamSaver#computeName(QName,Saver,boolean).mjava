        private static XMLName computeName ( QName name, Saver saver, boolean needsPrefix )
        {
            String uri = name.getNamespaceURI();
            String local = name.getLocalPart();

            assert uri != null;
            assert local.length() > 0;

            String prefix = null;

            if (uri!=null && uri.length() != 0)
            {
                prefix = name.getPrefix();
                String mappedUri = saver.getNamespaceForPrefix( prefix );

                if (mappedUri == null || !mappedUri.equals( uri ))
                    prefix = saver.getUriMapping( uri );

                // Attrs need a prefix.  If I have not found one, then there must be a default
                // prefix obscuring the prefix needed for this attr.  Find it manually.

                // NOTE - Consider keeping the currently mapped default URI separate fromn the
                // _urpMap and _prefixMap.  This way, I would not have to look it up manually
                // here

                if (needsPrefix && prefix.length() == 0)
                    prefix = saver.getNonDefaultUriMapping( uri );

            }

            return new XmlNameImpl( uri, local, prefix );
        }

