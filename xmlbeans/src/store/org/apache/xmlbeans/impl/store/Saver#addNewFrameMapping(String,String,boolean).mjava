    private final void addNewFrameMapping ( String prefix, String uri, boolean ensureDefaultEmpty )
    {
        // If the prefix maps to "", this don't include this mapping 'cause it's not well formed.
        // Also, if we want to make sure that the default namespace is always "", then check that
        // here as well.

        if ((prefix.length() == 0 || uri.length() > 0) &&
                (!ensureDefaultEmpty || prefix.length() > 0 || uri.length() == 0))
        {
            // Make sure the prefix is not already mapped in this frame

            for ( iterateMappings() ; hasMapping() ; nextMapping() )
                if (mappingPrefix().equals( prefix ))
                    return;

            // Also make sure that the prefix declaration is not redundant
            // This has the side-effect of making it impossible to set a
            // redundant prefix declaration, but seems that it's better
            // to just never issue a duplicate prefix declaration.
            if (uri.equals(getNamespaceForPrefix(prefix)))
                return;

            addMapping( prefix, uri );
        }
    }

