    public void fill(int requestedBytes) throws IOException
    {
        do
        {
            int chars = reader.read(buf);
            if (chars < 0)
                return;

            writer.write(buf, 0, chars);
            writer.flush();
        }
        while (available() <= 0); // loop for safety, in case encoding didn't produce any bytes yet
    }

