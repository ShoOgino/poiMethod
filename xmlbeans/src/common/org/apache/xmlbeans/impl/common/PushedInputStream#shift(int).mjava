    /**
     * Makes room for cb more bytes of data
     */
    private void shift(int cb)
    {
        int savepos = readpos;
        if (markpos > 0)
        {
            if (readpos - markpos > marklimit)
                markpos = -1;
            else
                savepos = markpos;
        }

        int size = writepos - savepos;

        if (savepos > 0 && buf.length - size >= cb && size <= cb)
        {
            System.arraycopy(buf, savepos, buf, 0, size);
        }
        else
        {
            int newcount = size + cb;
            byte newbuf[] = new byte[Math.max(buf.length << 1, newcount)];
            System.arraycopy(buf, savepos, newbuf, 0, size);
            buf = newbuf;
        }

        if (savepos > 0)
        {
            readpos -= savepos;
            if (markpos > 0)
                markpos -= savepos;
            writepos -= savepos;
        }
    }

